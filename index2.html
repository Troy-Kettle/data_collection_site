<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vital Signs Concern Levels</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSS Styles -->
    <style>
        /* Global Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f9fc;
            color: #333;
            padding: 0;
            margin: 0;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
            margin: 40px 0 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }
        /* Vital Sign Styles */
        .vital-sign {
            background-color: #fff;
            border-radius: 8px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        .vital-sign h3 {
            margin-top: 0;
            color: #3498db;
            font-size: 1.8em;
        }
        /* Scale Styles */
        .scale-container {
            position: relative;
            margin: 60px 0 40px 0;
            height: 120px; /* Increased to accommodate multiple arrow levels */
        }
        .track {
            position: relative;
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            margin: 30px 0;
            cursor: pointer;
        }
        .range {
            position: absolute;
            height: 12px;
            border-radius: 6px;
            top: 0;
        }
        .thumb {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            transform: translateX(-50%);
            cursor: pointer;
        }
        .thumb-normal {
            border-top: 18px solid #2ecc71; /* Green */
            top: -18px;
        }
        .thumb-mild {
            border-top: 18px solid #f1c40f; /* Yellow */
            top: -36px;
        }
        .thumb-moderate {
            border-top: 18px solid #e67e22; /* Orange */
            top: -54px;
        }
        .thumb-severe {
            border-top: 18px solid #e74c3c; /* Red */
            top: -72px;
        }
        .thumb-label {
            position: absolute;
            transform: translateX(-50%);
            font-size: 0.9em;
            white-space: nowrap;
            background: #fff;
            padding: 5px 8px;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .thumb-label-normal {
            top: -90px;
        }
        .thumb-label-mild {
            top: -110px;
        }
        .thumb-label-moderate {
            top: -130px;
        }
        .thumb-label-severe {
            top: -150px;
        }
        /* Tick Marks and Labels */
        .labels {
            position: absolute;
            width: 100%;
            top: 40px;
            font-size: 0.9em;
            pointer-events: none;
        }
        .labels span {
            position: absolute;
            transform: translateX(-50%);
            white-space: nowrap;
            color: #555;
        }
        .tick-marks {
            position: absolute;
            width: 100%;
            top: 8px;
            height: 16px;
            overflow: visible;
        }
        .tick {
            position: absolute;
            width: 2px;
            background-color: #999;
        }
        .tick.major {
            height: 16px;
        }
        .tick.minor {
            height: 10px;
        }
        /* Concern Levels */
        .concern-levels {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
        }
        .concern-level {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            color: #fff;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 1em;
            border-radius: 4px;
            margin: 0 5px;
            opacity: 1;
        }
        .no-concern { background-color: #2ecc71; }
        .mild-concern { background-color: #f1c40f; }
        .moderate-concern { background-color: #e67e22; }
        .severe-concern { background-color: #e74c3c; }
        /* Submit Button */
        #submitButton {
            display: block;
            margin: 60px auto;
            padding: 18px 36px;
            font-size: 1.2em;
            color: #fff;
            background-color: #3498db;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #submitButton:hover {
            background-color: #2980b9;
        }
        /* Table Styles */
        .threshold-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 40px;
        }
        .threshold-table th, .threshold-table td {
            border: 1px solid #ccc;
            padding: 14px;
            text-align: left;
        }
        .threshold-table th {
            background-color: #f5f5f5;
            font-weight: 700;
        }
        /* Part 2 Styles */
        #part2Container {
            margin-top: 80px;
        }
        .combination {
            background-color: #fff;
            border-radius: 8px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        .combination h3 {
            margin-top: 0;
            color: #3498db;
            font-size: 1.8em;
        }
        .combination-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 40px;
        }
        .combination-table th, .combination-table td {
            border: 1px solid #ccc;
            padding: 14px;
            text-align: left;
        }
        .combination-table th {
            background-color: #f5f5f5;
            font-weight: 700;
        }
        .slider-container {
            margin-top: 40px;
        }
        .slider-container label {
            display: block;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1em;
            color: #555;
        }
        .slider-container input[type="range"] {
            width: 100%;
        }
        .slider-container span {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            font-size: 1em;
            color: #333;
        }
        /* Part 3 Styles */
        #part3Container {
            margin-top: 80px;
        }
        .question-set {
            background-color: #fff;
            border-radius: 8px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        .question-set h3 {
            margin-top: 0;
            color: #3498db;
            font-size: 1.8em;
        }
        .question {
            margin-bottom: 25px;
        }
        .question label {
            display: block;
            margin-bottom: 10px;
            font-size: 1em;
            color: #555;
        }
        .question .slider-container {
            display: flex;
            align-items: center;
        }
        .question .slider-container input[type="range"] {
            flex: 1;
        }
        .question .slider-container span {
            margin-left: 10px;
            font-weight: bold;
        }
        /* Responsive Design */
        @media screen and (max-width: 768px) {
            .vital-sign, .question-set, .combination {
                padding: 30px;
            }
            .thumb-label {
                top: -70px;
            }
            .concern-levels {
                flex-direction: column;
            }
            .concern-level {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Vital Signs Concern Level Boundaries</h1>
        <div id="vitalSignsContainer"></div>

        <!-- Part 2: Combinations of Vital Signs -->
        <h2>Part 2: Combinations of Vital Signs</h2>
        <div id="part2Container"></div>

        <!-- Part 3: Further Interpretation of Vital Signs -->
        <h2>Part 3: Further Interpretation of Vital Signs</h2>
        <div id="part3Container"></div>

        <button id="submitButton">Submit</button>
    </div>

    <script>
        // Vital Signs Data
        const vitalSignsData = [
            {
                name: "Heart Rate",
                unit: "beats/min",
                min: 20,
                max: 200,
                step: 1,
                majorTick: 10,
                hasBothDirections: true
            },
            {
                name: "Systolic Blood Pressure",
                unit: "mmHg",
                min: 40,
                max: 250,
                step: 1,
                majorTick: 10,
                hasBothDirections: true
            },
            {
                name: "Respiratory Rate",
                unit: "breaths/min",
                min: 1,
                max: 60,
                step: 1,
                majorTick: 5,
                hasBothDirections: true
            },
            {
                name: "Temperature",
                unit: "℃",
                min: 32.0,
                max: 42.0,
                step: 0.1,
                majorTick: 1,
                hasBothDirections: true
            },
            {
                name: "Oxygen Saturation",
                unit: "%",
                min: 50,
                max: 100,
                step: 1,
                majorTick: 5,
                hasBothDirections: false,
                reverseScale: true
            }
        ];

        // Function to create vital sign elements
        function createVitalSignElement(vitalSign) {
            const container = document.createElement('div');
            container.className = 'vital-sign';

            const title = document.createElement('h3');
            title.textContent = `${vitalSign.name} (${vitalSign.unit})`;
            container.appendChild(title);

            const scaleContainer = document.createElement('div');
            scaleContainer.className = 'scale-container';
            container.appendChild(scaleContainer);

            const track = document.createElement('div');
            track.className = 'track';
            scaleContainer.appendChild(track);

            const ranges = [];
            const thumbs = [];
            const thumbLabels = [];

            const levels = getConcernLevels(vitalSign);

            let thresholds = [];
            let numArrows = getNumArrows(vitalSign);
            const min = vitalSign.min;
            const max = vitalSign.max;

            // Initialize thresholds at random positions
            thresholds.push({ value: min, levelIndex: 0, lastAdjusted: false }); // thresholds[0] - fixed
            const positions = getInitialPositions(numArrows, min, max, vitalSign.step);
            positions.forEach((pos, idx) => thresholds.push({ value: pos, levelIndex: idx + 1, lastAdjusted: false }));
            thresholds.push({ value: max, levelIndex: levels.length - 1, lastAdjusted: false }); // Last threshold - fixed

            // Add tick marks and labels
            const tickMarksContainer = document.createElement('div');
            tickMarksContainer.className = 'tick-marks';
            scaleContainer.appendChild(tickMarksContainer);

            const labelsContainer = document.createElement('div');
            labelsContainer.className = 'labels';
            scaleContainer.appendChild(labelsContainer);

            // Function to add tick marks and labels
            function addTickMarksAndLabels() {
                tickMarksContainer.innerHTML = '';
                labelsContainer.innerHTML = '';

                const totalTicks = 100; // Total number of minor ticks
                for (let i = 0; i <= totalTicks; i++) {
                    const percent = (i / totalTicks) * 100;
                    const value = min + (percent / 100) * (max - min);

                    const tick = document.createElement('div');
                    tick.className = 'tick minor';
                    tick.style.left = `${percent}%`;
                    tick.dataset.value = value;
                    tickMarksContainer.appendChild(tick);
                }

                // Add major ticks and labels
                let currentValue = min;
                while (currentValue <= max) {
                    const percent = ((currentValue - min) / (max - min)) * 100;

                    const tick = document.createElement('div');
                    tick.className = 'tick major';
                    tick.style.left = `${percent}%`;
                    tick.dataset.value = currentValue;
                    tickMarksContainer.appendChild(tick);

                    const label = document.createElement('span');
                    label.textContent = formatValueForLabel(currentValue, vitalSign);
                    label.style.left = `${percent}%`;
                    labelsContainer.appendChild(label);

                    currentValue += vitalSign.majorTick;
                }
            }

            addTickMarksAndLabels();

            const concernLevelsContainer = document.createElement('div');
            concernLevelsContainer.className = 'concern-levels';
            levels.forEach(level => {
                const levelDiv = document.createElement('div');
                levelDiv.className = `concern-level ${level.class}`;
                levelDiv.textContent = level.label;
                concernLevelsContainer.appendChild(levelDiv);
            });
            container.appendChild(concernLevelsContainer);

            // Create table to display ranges
            const thresholdTable = document.createElement('table');
            thresholdTable.className = 'threshold-table';

            const tableHeader = document.createElement('thead');
            const headerRow = document.createElement('tr');

            const levelHeader = document.createElement('th');
            levelHeader.textContent = 'Concern Level';

            const lowerHeader = document.createElement('th');
            lowerHeader.textContent = 'Lower Limit';

            const upperHeader = document.createElement('th');
            upperHeader.textContent = 'Upper Limit';

            headerRow.appendChild(levelHeader);
            headerRow.appendChild(lowerHeader);
            headerRow.appendChild(upperHeader);
            tableHeader.appendChild(headerRow);
            thresholdTable.appendChild(tableHeader);

            const tableBody = document.createElement('tbody');
            thresholdTable.appendChild(tableBody);

            container.appendChild(thresholdTable);

            function createThumbs() {
                // Clear existing thumbs and ranges
                thumbs.forEach(thumb => thumb.remove());
                thumbLabels.forEach(label => label.remove());
                ranges.forEach(range => range.remove());
                thumbs.length = 0;
                thumbLabels.length = 0;
                ranges.length = 0;

                // Recreate thumbs and labels
                thresholds.forEach((threshold, index) => {
                    if (index > 0 && index < thresholds.length - 1) {
                        const level = getArrowLevel(index, vitalSign);
                        const thumb = document.createElement('div');
                        thumb.className = `thumb ${level.thumbClass}`;
                        thumb.dataset.index = index;
                        scaleContainer.appendChild(thumb);
                        thumbs.push(thumb);

                        // Create label for thumb
                        const thumbLabel = document.createElement('div');
                        thumbLabel.className = `thumb-label ${level.thumbLabelClass}`;
                        thumbLabel.textContent = formatValue(threshold.value, vitalSign);
                        scaleContainer.appendChild(thumbLabel);
                        thumbLabels.push(thumbLabel);

                        // Event listeners for thumb
                        let isDragging = false;
                        thumb.addEventListener('mousedown', e => {
                            isDragging = true;
                            currentThumb = thumb;
                            currentThumbIndex = parseInt(thumb.dataset.index);
                            document.addEventListener('mousemove', onMouseMove);
                            document.addEventListener('mouseup', onMouseUp);
                            e.preventDefault();
                        });

                        function onMouseMove(e) {
                            if (!isDragging) return;
                            const rect = track.getBoundingClientRect();
                            let offsetX = e.clientX - rect.left;
                            offsetX = Math.max(0, Math.min(offsetX, rect.width));
                            const percent = offsetX / rect.width;
                            let value = min + percent * (max - min);

                            // Snap to nearest step
                            value = Math.round(value / vitalSign.step) * vitalSign.step;
                            value = Math.max(min, Math.min(value, max));

                            thresholds[currentThumbIndex].value = value;

                            // Enforce boundaries
                            enforceBoundaries(currentThumbIndex, value);

                            // Set lastAdjusted
                            thresholds.forEach((t, idx) => {
                                t.lastAdjusted = (idx === currentThumbIndex);
                            });

                            updatePositions();
                        }

                        function onMouseUp() {
                            isDragging = false;
                            document.removeEventListener('mousemove', onMouseMove);
                            document.removeEventListener('mouseup', onMouseUp);
                        }
                    }
                });

                // Create ranges between thresholds
                for (let i = 0; i < thresholds.length - 1; i++) {
                    const range = document.createElement('div');
                    range.className = 'range';
                    scaleContainer.appendChild(range);
                    ranges.push(range);
                }
            }

            function enforceBoundaries(index, value) {
                const threshold = thresholds[index];

                // Ensure thresholds stay within min and max
                if (value < min) {
                    threshold.value = min;
                } else if (value > max) {
                    threshold.value = max;
                } else {
                    threshold.value = value;
                }

                // Prevent thresholds from crossing over
                if (index > 0) {
                    if (thresholds[index - 1].value > threshold.value) {
                        thresholds[index - 1].value = threshold.value;
                        enforceBoundaries(index - 1, thresholds[index - 1].value);
                    }
                }

                if (index < thresholds.length - 1) {
                    if (thresholds[index + 1].value < threshold.value) {
                        thresholds[index + 1].value = threshold.value;
                        enforceBoundaries(index + 1, thresholds[index + 1].value);
                    }
                }
            }

            function updatePositions() {
                // Update thumbs and labels
                thresholds.forEach((threshold, index) => {
                    if (index > 0 && index < thresholds.length - 1) {
                        const percent = ((threshold.value - min) / (max - min)) * 100;
                        const thumb = thumbs[index - 1];
                        thumb.style.left = `${percent}%`;

                        // Update thumb label position and value
                        const thumbLabel = thumbLabels[index - 1];
                        thumbLabel.style.left = `${percent}%`;
                        thumbLabel.textContent = formatValue(threshold.value, vitalSign);
                        thumbLabel.style.display = 'block';
                    }
                });

                // Build merged ranges
                const mergedRanges = [];
                let i = 0;
                while (i < thresholds.length - 1) {
                    let startThreshold = thresholds[i];
                    let endIndex = i + 1;

                    // Merge ranges where thresholds have the same value
                    while (endIndex < thresholds.length && thresholds[endIndex].value === thresholds[i].value) {
                        endIndex++;
                    }

                    // Determine concern level
                    let levelIndex = thresholds[i].levelIndex;
                    if (endIndex - i > 1) {
                        for (let j = i; j < endIndex; j++) {
                            if (thresholds[j].lastAdjusted) {
                                levelIndex = thresholds[j].levelIndex;
                                break;
                            }
                        }
                    }

                    // Create range
                    let startValue = thresholds[i].value;
                    let endValue = thresholds[endIndex] ? thresholds[endIndex].value : thresholds[thresholds.length - 1].value;
                    let startPercent = ((startValue - min) / (max - min)) * 100;
                    let endPercent = ((endValue - min) / (max - min)) * 100;
                    let width = endPercent - startPercent;

                    mergedRanges.push({
                        left: startPercent,
                        width: width,
                        levelIndex: levelIndex
                    });

                    i = endIndex;
                }

                // Update ranges
                ranges.forEach(range => range.remove());
                ranges.length = 0;

                mergedRanges.forEach(rangeData => {
                    const range = document.createElement('div');
                    range.className = 'range';
                    range.style.left = `${rangeData.left}%`;
                    range.style.width = `${rangeData.width}%`;
                    range.style.backgroundColor = levels[rangeData.levelIndex].color;
                    range.style.zIndex = 1;
                    scaleContainer.appendChild(range);
                    ranges.push(range);
                });

                // Update tick marks colors
                updateTickMarksColor();

                // Update the table
                updateThresholdTable(mergedRanges);
            }

            function updateTickMarksColor() {
                const tickElements = tickMarksContainer.querySelectorAll('.tick');
                tickElements.forEach(tick => {
                    const value = parseFloat(tick.dataset.value);
                    const color = getTickColor(value, thresholds, levels);
                    tick.style.backgroundColor = color;
                });
            }

            function updateThresholdTable(mergedRanges) {
                // Clear existing table rows
                tableBody.innerHTML = '';

                // For each merged range, create a table row
                mergedRanges.forEach(rangeData => {
                    const row = document.createElement('tr');
                    const levelCell = document.createElement('td');
                    levelCell.textContent = levels[rangeData.levelIndex].label;

                    const lowerLimit = formatValue(min + (rangeData.left / 100) * (max - min), vitalSign);
                    const upperLimit = formatValue(min + ((rangeData.left + rangeData.width) / 100) * (max - min), vitalSign);

                    const lowerCell = document.createElement('td');
                    lowerCell.textContent = lowerLimit;

                    const upperCell = document.createElement('td');
                    upperCell.textContent = upperLimit;

                    row.appendChild(levelCell);
                    row.appendChild(lowerCell);
                    row.appendChild(upperCell);
                    tableBody.appendChild(row);
                });
            }

            function formatValue(value, vitalSign) {
                if (vitalSign.unit === '℃') {
                    return value.toFixed(1);
                } else if (vitalSign.unit === 'L/min') {
                    return value.toFixed(1);
                } else {
                    return Math.round(value);
                }
            }

            function formatValueForLabel(value, vitalSign) {
                return formatValue(value, vitalSign);
            }

            function getConcernLevels(vitalSign) {
                if (vitalSign.name === "Oxygen Saturation") {
                    return [
                        { label: 'Low - severe concern', class: 'severe-concern', color: '#e74c3c' },
                        { label: 'Low - moderate concern', class: 'moderate-concern', color: '#e67e22' },
                        { label: 'Low - mild concern', class: 'mild-concern', color: '#f1c40f' },
                        { label: 'No concern', class: 'no-concern', color: '#2ecc71' }
                    ];
                } else {
                    return [
                        { label: 'Low - severe concern', class: 'severe-concern', color: '#e74c3c' },
                        { label: 'Low - moderate concern', class: 'moderate-concern', color: '#e67e22' },
                        { label: 'Low - mild concern', class: 'mild-concern', color: '#f1c40f' },
                        { label: 'No concern', class: 'no-concern', color: '#2ecc71' },
                        { label: 'High - mild concern', class: 'mild-concern', color: '#f1c40f' },
                        { label: 'High - moderate concern', class: 'moderate-concern', color: '#e67e22' },
                        { label: 'High - severe concern', class: 'severe-concern', color: '#e74c3c' }
                    ];
                }
            }

            function getTickColor(value, thresholds, levels) {
                for (let i = 0; i < thresholds.length - 1; i++) {
                    const lowerLimit = thresholds[i].value;
                    const upperLimit = thresholds[i + 1].value;
                    if (value >= lowerLimit && value <= upperLimit) {
                        return levels[thresholds[i].levelIndex].color;
                    }
                }
                return '#999';
            }

            function getArrowLevel(index, vitalSign) {
                if (vitalSign.name === "Oxygen Saturation") {
                    switch (index) {
                        case 1:
                            return { thumbClass: 'thumb-severe', thumbLabelClass: 'thumb-label-severe' };
                        case 2:
                            return { thumbClass: 'thumb-moderate', thumbLabelClass: 'thumb-label-moderate' };
                        case 3:
                            return { thumbClass: 'thumb-mild', thumbLabelClass: 'thumb-label-mild' };
                        default:
                            return { thumbClass: '', thumbLabelClass: '' };
                    }
                } else {
                    switch (index) {
                        case 1:
                            return { thumbClass: 'thumb-severe', thumbLabelClass: 'thumb-label-severe' };
                        case 2:
                            return { thumbClass: 'thumb-moderate', thumbLabelClass: 'thumb-label-moderate' };
                        case 3:
                            return { thumbClass: 'thumb-mild', thumbLabelClass: 'thumb-label-mild' };
                        case 4:
                            return { thumbClass: 'thumb-mild', thumbLabelClass: 'thumb-label-mild' };
                        case 5:
                            return { thumbClass: 'thumb-moderate', thumbLabelClass: 'thumb-label-moderate' };
                        case 6:
                            return { thumbClass: 'thumb-severe', thumbLabelClass: 'thumb-label-severe' };
                        default:
                            return { thumbClass: '', thumbLabelClass: '' };
                    }
                }
            }

            function getNumArrows(vitalSign) {
                if (vitalSign.name === "Oxygen Saturation") {
                    return 3; // thresholds[1] to thresholds[3]
                } else {
                    return 6; // thresholds[1] to thresholds[6]
                }
            }

            // Function to initialize arrows at random positions within the range
            function getInitialPositions(numArrows, min, max, step) {
                const positions = [];
                for (let i = 0; i < numArrows; i++) {
                    const randomValue = min + Math.random() * (max - min);
                    const snappedValue = Math.max(min, Math.min(Math.round(randomValue / step) * step, max));
                    positions.push(snappedValue);
                }
                // Sort positions to prevent overlapping thresholds
                return positions.sort((a, b) => a - b);
            }

            vitalSign.getValues = function() {
                if (thresholds.length > 2) {
                    return thresholds.slice(1, -1).map(t => formatValue(t.value, vitalSign));
                } else {
                    return [];
                }
            };

            let currentThumb = null;
            let currentThumbIndex = null;

            createThumbs();
            updatePositions();

            return container;
        }

        function collectData() {
            const data = {};
            data.thresholds = [];
            vitalSignsData.forEach(vitalSign => {
                const values = vitalSign.getValues();
                data.thresholds.push({
                    'Vital Sign': vitalSign.name,
                    'Unit': vitalSign.unit,
                    'Values': values.join(';')
                });
            });

            // Collect responses from Part 3
            const part3Responses = [];
            vitalSignsData.forEach(vitalSign => {
                const response = {
                    'Vital Sign': vitalSign.name,
                    'Questions': {}
                };
                part3Questions.forEach(question => {
                    const sliderInput = document.querySelector(`input[name="${vitalSign.name}-${question}"]`);
                    response['Questions'][question] = sliderInput.value;
                });
                part3Responses.push(response);
            });
            data.part3Responses = part3Responses;

            // Collect ratings from Part 2
            const part2Ratings = combinations.map((combination, index) => {
                const sliderInput = document.querySelector(`input[name="combination-${index}"]`);
                const rating = sliderInput.value;
                return {
                    'Combination': index + 1,
                    'Rating': rating
                };
            });
            data.part2Ratings = part2Ratings;

            return data;
        }

        function downloadCSV(data) {
            let csvContent = 'data:text/csv;charset=utf-8,';
            csvContent += 'Vital Sign,Unit,Thresholds\n';
            data.thresholds.forEach(row => {
                csvContent += `${row['Vital Sign']},${row['Unit']},${row['Values']}\n`;
            });

            // Add Part 3 responses
            csvContent += '\nPart 3 Responses\n';
            data.part3Responses.forEach(response => {
                csvContent += `Vital Sign: ${response['Vital Sign']}\n`;
                Object.keys(response['Questions']).forEach(question => {
                    csvContent += `${question},${response['Questions'][question]}\n`;
                });
                csvContent += '\n';
            });

            // Add Part 2 ratings
            csvContent += '\nPart 2 Ratings\n';
            csvContent += 'Combination,Rating\n';
            data.part2Ratings.forEach(row => {
                csvContent += `${row['Combination']},${row['Rating']}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'vital_signs_data.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        const vitalSignsContainer = document.getElementById('vitalSignsContainer');

        vitalSignsData.forEach(vitalSign => {
            const vitalSignElement = createVitalSignElement(vitalSign);
            vitalSignsContainer.appendChild(vitalSignElement);
        });

        // Part 3 Questions
        const part3Questions = [
            "What is normal for that individual patient.",
            "Whether the general trend is worsening or improving",
            "Abnormal values that have occurred within the past 24 hours"
        ];

        // Create Part 3 Section (Further Interpretation)
        const part3Container = document.getElementById('part3Container');

        vitalSignsData.forEach(vitalSign => {
            const questionSet = document.createElement('div');
            questionSet.className = 'question-set';

            const title = document.createElement('h3');
            title.textContent = `When interpreting ${vitalSign.name}, how important is it to take account of:`;
            questionSet.appendChild(title);

            // Add subheading
            const subheading = document.createElement('h4');
            subheading.innerHTML = '0 = not at all important<br> 5 = moderately important<br> 10 = Extremely important:';
            questionSet.appendChild(subheading);

            part3Questions.forEach(questionText => {
                const question = document.createElement('div');
                question.className = 'question';

                const label = document.createElement('label');
                label.textContent = questionText;
                label.setAttribute('for', `${vitalSign.name}-${questionText}`);
                question.appendChild(label);

                // Create slider
                const sliderContainer = document.createElement('div');
                sliderContainer.className = 'slider-container';

                const sliderInput = document.createElement('input');
                sliderInput.type = 'range';
                sliderInput.min = 0;
                sliderInput.max = 10;
                sliderInput.value = 5;
                sliderInput.name = `${vitalSign.name}-${questionText}`;
                sliderContainer.appendChild(sliderInput);

                const sliderValueDisplay = document.createElement('span');
                sliderValueDisplay.textContent = '5';
                sliderContainer.appendChild(sliderValueDisplay);

                sliderInput.addEventListener('input', () => {
                    sliderValueDisplay.textContent = sliderInput.value;
                });

                question.appendChild(sliderContainer);
                questionSet.appendChild(question);
            });

            part3Container.appendChild(questionSet);
        });

        // Part 2: Combinations of vital signs
        const combinations = [
            {'Heart Rate': { value: "High", abnormal: true }, 'Systolic Blood Pressure': { value: 'Low', abnormal: true }, 'Respiratory Rate': { value: "Normal", abnormal: false }, 'Temperature': { value: "Normal", abnormal: false }, 'Oxygen Saturation': { value: "Normal", abnormal: false }},
            {'Heart Rate': { value: "High", abnormal: true }, 'Systolic Blood Pressure': { value: 'Normal', abnormal: false }, 'Respiratory Rate': { value: "High", abnormal: true }, 'Temperature': { value: "Normal", abnormal: false }, 'Oxygen Saturation': { value: "Normal", abnormal: false }},
            {'Heart Rate': { value: "High", abnormal: true }, 'Systolic Blood Pressure': { value: 'Normal', abnormal: false }, 'Respiratory Rate': { value: "Normal", abnormal: false }, 'Temperature': { value: "Low", abnormal: true }, 'Oxygen Saturation': { value: "Normal", abnormal: false }},
            {'Heart Rate': { value: "High", abnormal: true }, 'Systolic Blood Pressure': { value: 'Normal', abnormal: false }, 'Respiratory Rate': { value: "Normal", abnormal: false }, 'Temperature': { value: "Normal", abnormal: false }, 'Oxygen Saturation': { value: "Low", abnormal: true }},
            {'Heart Rate': { value: "Normal", abnormal: false }, 'Systolic Blood Pressure': { value: 'Low', abnormal: true }, 'Respiratory Rate': { value: "High", abnormal: true }, 'Temperature': { value: "Normal", abnormal: false }, 'Oxygen Saturation': { value: "Normal", abnormal: false }},
            {'Heart Rate': { value: "Normal", abnormal: false }, 'Systolic Blood Pressure': { value: 'Low', abnormal: true }, 'Respiratory Rate': { value: "Normal", abnormal: false }, 'Temperature': { value: "Low", abnormal: true }, 'Oxygen Saturation': { value: "Normal", abnormal: false }},
            {'Heart Rate': { value: "Normal", abnormal: false }, 'Systolic Blood Pressure': { value: 'Low', abnormal: true }, 'Respiratory Rate': { value: "Normal", abnormal: false }, 'Temperature': { value: 'Normal', abnormal: false }, 'Oxygen Saturation': { value: "Low", abnormal: true }},
            {'Heart Rate': { value: "Normal", abnormal: false }, 'Systolic Blood Pressure': { value: 'Normal', abnormal: false }, 'Respiratory Rate': { value: "High", abnormal: true }, 'Temperature': { value: "Low", abnormal: true }, 'Oxygen Saturation': { value: "Normal", abnormal: false }},
            {'Heart Rate': { value: "Normal", abnormal: false }, 'Systolic Blood Pressure': { value: 'Normal', abnormal: false }, 'Respiratory Rate': { value: "High", abnormal: true }, 'Temperature': { value: "Normal", abnormal: false }, 'Oxygen Saturation': { value: "Low", abnormal: true }},
            {'Heart Rate': { value: "Normal", abnormal: false }, 'Systolic Blood Pressure': { value: 'Normal', abnormal: false }, 'Respiratory Rate': { value: "Normal", abnormal: false }, 'Temperature': { value: "Low", abnormal: true }, 'Oxygen Saturation': { value: "Low", abnormal: true }}
        ];

        function createCombinationElement(combination, index) {
            const container = document.createElement('div');
            container.className = 'combination';

            const title = document.createElement('h3');
            title.textContent = `Combination ${index + 1}`;
            container.appendChild(title);

            const table = document.createElement('table');
            table.className = 'combination-table';
            const tbody = document.createElement('tbody');

            Object.keys(combination).forEach(vitalSignName => {
                const vitalSignData = combination[vitalSignName];
                const value = vitalSignData.value;
                const isAbnormal = vitalSignData.abnormal;

                const tr = document.createElement('tr');

                const tdVitalSign = document.createElement('td');
                tdVitalSign.textContent = vitalSignName;
                tr.appendChild(tdVitalSign);

                const tdValue = document.createElement('td');
                tdValue.textContent = value;
                if (isAbnormal) {
                    tdValue.style.color = '#e74c3c';
                    tdValue.style.fontWeight = 'bold';
                }
                tr.appendChild(tdValue);

                tbody.appendChild(tr);
            });

            table.appendChild(tbody);
            container.appendChild(table);

            // Slider for rating (0 to 10)
            const sliderContainer = document.createElement('div');
            sliderContainer.className = 'slider-container';

            const sliderLabel = document.createElement('label');
            sliderLabel.innerHTML = 'Rate your level of concern:<br>0 = No more concerning than the individual abnormalities<br>5 = Moderately more concerning than individual abnormalities<br>10 = The combination is very much more concerning than the individual abnormalities';
            sliderContainer.appendChild(sliderLabel);

            const sliderInput = document.createElement('input');
            sliderInput.type = 'range';
            sliderInput.min = 0;
            sliderInput.max = 10;
            sliderInput.value = 5;
            sliderInput.step = 1;
            sliderInput.name = `combination-${index}`;
            sliderContainer.appendChild(sliderInput);

            const sliderValueDisplay = document.createElement('span');
            sliderValueDisplay.textContent = '5';
            sliderContainer.appendChild(sliderValueDisplay);

            sliderInput.addEventListener('input', () => {
                sliderValueDisplay.textContent = sliderInput.value;
            });

            container.appendChild(sliderContainer);

            return container;
        }

        const part2Container = document.getElementById('part2Container');

        combinations.forEach((combination, index) => {
            const combinationElement = createCombinationElement(combination, index);
            part2Container.appendChild(combinationElement);
        });

        const submitButton = document.getElementById('submitButton');
        submitButton.addEventListener('click', () => {
            const data = collectData();
            downloadCSV(data);
        });
    </script>
</body>
</html>